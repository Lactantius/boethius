require 'boethius/metadata'
require 'boethius/xmlenv'
require 'boethius/filenames'

module Boethius

  class Tex < Hash

    BOILERPLATE = <<~IN
      %LuaTeX

      % This file has been generated by Boethius,
      % which is freely distributed under the AGPLv3.
      % Copyright 2017, Gerard Keiser
    IN

    def generate
      filename = "#{File.join(Boethius::PROJECTDIR, self[:id])}"
      @source = Source.new("#{filename}.tex", "w")
      @source.puts BOILERPLATE
      @source.puts ''
      @source.metadata self
      @source.puts ''
      @source.xmlenv self
      @source.puts ''
      @source.puts '\starttext'
      @source.puts ''
      @source.filenames self
      @source.puts ''
      @source.puts '\stoptext'
      return @source
    ensure
      @source.close
    end

  end

end
